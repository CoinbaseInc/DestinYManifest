<?xml version="1.0"?>

<!--

  c172p damage effects for JSBSim.

    Copyright (c) 2015 Wayne Bragg

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

-->

<system name="c172p ground effects">

    <channel name="contact-points">

        <fcs_function name="z-position-nose-gear">
            <output>gear/unit[0]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[0]/broken</property>
                    <value>0.0</value>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value>-19.5</value>
                        <value>-22.0</value>
                        <value>-22.0</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>-22.0</value>
                    </switch>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="z-position-left-gear">
            <output>gear/unit[1]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[1]/broken</property>
                    <value>0.0</value>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value>-15.5</value>
                        <value>-20.0</value>
                        <value>-22.0</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>-22.0</value>
                    </switch>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="z-position-right-gear">
            <output>gear/unit[2]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[2]/broken</property>
                    <value>0.0</value>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value>-15.5</value>
                        <value>-20.0</value>
                        <value>-22.0</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>-22.0</value>
                    </switch>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="z-position-effect-nose-gear">
            <output>contact/unit[6]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[0]/broken</property>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value>-10.0</value>
                        <value>-18.5</value>
                        <value>-17.7</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>  0.0</value> <!-- TODO No z-position for skis? -->
                    </switch>
                    <value>0.0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="z-position-effect-left-gear">
            <output>contact/unit[7]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[1]/broken</property>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value> -9.5</value>
                        <value>-14.5</value>
                        <value>-16.0</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>-14.0</value>
                    </switch>
                    <value>0.0</value>
                </ifthen>
            </function>
        </fcs_function>

        <fcs_function name="z-position-effect-right-gear">
            <output>contact/unit[8]/z-position</output>
            <function>
                <ifthen>
                    <property>gear/unit[2]/broken</property>
                    <switch>
                        <property>bushkit</property>

                        <!-- Default/26"/36"/pontoon/amphibious/skis -->
                        <value> -8.0</value>
                        <value>-15.5</value>
                        <value>-17.4</value>
                        <value>  0.0</value>
                        <value>  0.0</value>
                        <value>-16.0</value>
                    </switch>
                    <value>0.0</value>
                </ifthen>
            </function>
        </fcs_function>

        <switch name="z-position-left-wing-tip">
            <output>contact/unit[4]/z-position</output>
            <default value="50"/>

            <test logic="AND" value="-8">
                crash EQ 1
            </test>

            <!-- -10 when on/above water -->
            <test logic="AND" value="-10">
                contact/unit[4]/solid EQ 0
            </test>

            <test logic="AND" value="40">
                wing-damage/left-wing EQ 1.0
                contact/unit[12]/WOW EQ 1
            </test>
        </switch>

        <switch name="z-position-right-wing-tip">
            <output>contact/unit[5]/z-position</output>
            <default value="50"/>

            <test logic="AND" value="-8">
                crash EQ 1
            </test>

            <!-- -10 when on/above water -->
            <test logic="AND" value="-10">
                contact/unit[5]/solid EQ 0
            </test>

            <test logic="AND" value="40">
                wing-damage/right-wing EQ 1.0
                contact/unit[12]/WOW EQ 1
            </test>
        </switch>

        <switch name="z-position-top-vertical-stabilizer">
            <output>contact/unit[12]/z-position</output>
            <default value="90"/>

            <!-- 160 puts tail higher in the air when upside down -->
            <test logic="AND" value="160">
                contact/unit[12]/solid EQ 0
            </test>
        </switch>

    </channel>

    <channel name="groundeffects">

        <switch name="gear-spin-nose">
            <output>gear/gear-spin-nose</output>
            <default value="15"/>
            <test logic="OR" value="13">
                bushkit EQ 1
                bushkit EQ 2
                bushkit EQ 5
            </test>
        </switch>

        <switch name="gear-spin-left">
            <output>gear/gear-spin-left</output>
            <default value="13"/>
            <test logic="OR" value="8">
                bushkit EQ 2
                bushkit EQ 5
            </test>
            <test logic="OR" value="10">
                bushkit EQ 1
            </test>
        </switch>

        <switch name="gear-spin-right">
            <output>gear/gear-spin-right</output>
            <default value="13"/>
            <test logic="OR" value="8">
                bushkit EQ 2
                bushkit EQ 5
            </test>
            <test logic="OR" value="10">
                bushkit EQ 1
            </test>
        </switch>

        <fcs_function name="ground/tail-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[3]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/left-wing-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[4]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                    <eq>
                        <property>/fdm/jsbsim/wing-damage/left-wing</property>
                        <value>0.0</value>
                    </eq>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/right-wing-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[5]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                    <eq>
                        <property>/fdm/jsbsim/wing-damage/right-wing</property>
                        <value>0.0</value>
                    </eq>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/nose-gear-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[6]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/left-gear-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[7]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/right-gear-ground-effect-speed-kt">
            <function>
                <product>
                    <property>/fdm/jsbsim/contact/unit[8]/WOW</property>
                    <property>/velocities/groundspeed-kt</property>
                </product>
            </function>
        </fcs_function>

        <fcs_function name="ground/nose-tyre-smoke-ground-effect-speed-kt">
            <function>
                <or>
                    <property>/gear/gear[0]/tyre-smoke</property>
                    <product>
                        <property>/gear/gear[0]/wow</property>
                        <gt>
                            <property>/velocities/groundspeed-kt</property>
                            <value>20.0</value>
                        </gt>
                        <gt>
                            <property>/fdm/jsbsim/ground/rolling_friction-factor</property>
                            <value>1</value>
                        </gt>
                    </product>
                </or>
            </function>
        </fcs_function>

        <fcs_function name="ground/left-tyre-smoke-ground-effect-speed-kt">
            <function>
                <or>
                    <property>/gear/gear[1]/tyre-smoke</property>
                    <product>
                        <property>/gear/gear[1]/wow</property>
                        <gt>
                            <property>/velocities/groundspeed-kt</property>
                            <value>20.0</value>
                        </gt>
                        <gt>
                            <property>/fdm/jsbsim/ground/rolling_friction-factor</property>
                            <value>1</value>
                        </gt>
                    </product>
                </or>
            </function>
        </fcs_function>

        <fcs_function name="ground/right-tyre-smoke-ground-effect-speed-kt">
            <function>
                <or>
                    <property>/gear/gear[2]/tyre-smoke</property>
                    <product>
                        <property>/gear/gear[2]/wow</property>
                        <gt>
                            <property>/velocities/groundspeed-kt</property>
                            <value>20.0</value>
                        </gt>
                        <gt>
                            <property>/fdm/jsbsim/ground/rolling_friction-factor</property>
                            <value>1</value>
                        </gt>
                    </product>
                </or>
            </function>
        </fcs_function>

    </channel>

</system>
